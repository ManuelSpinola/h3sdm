<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>h3sdm workflow for a single model • h3sdm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="h3sdm workflow for a single model">
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">h3sdm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/h3sdm.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/multi_model_workflow.html">h3sdm workflow for multiple models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ManuelSpinola/h3sdm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>h3sdm workflow for a single model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ManuelSpinola/h3sdm/blob/HEAD/vignettes/h3sdm.Rmd" class="external-link"><code>vignettes/h3sdm.Rmd</code></a></small>
      <div class="d-none name"><code>h3sdm.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial demonstrates a complete workflow for species
distribution modeling (SDM) for a single species using h3sdm and related
packages. We cover data preparation, model fitting, spatial
cross-validation, prediction, and feature importance analysis.</p>
<p><strong>Note:</strong> The h3sdm package depends on the
<strong>paisaje</strong> package for data access and processing
functions. paisaje is not available on CRAN, so it must be installed
from GitHub using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ManuelSpinola/paisaje"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ManuelSpinola/h3sdm" class="external-link">h3sdm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://manuelspinola.github.io/paisaje/" class="external-link">paisaje</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/spatialsample" class="external-link">spatialsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/DALEX/" class="external-link">DALEX</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ModelOriented.github.io/DALEXtra/" class="external-link">DALEXtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ModelOriented.github.io/ingredients/" class="external-link">ingredients</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://isciences.gitlab.io/exactextractr/" class="external-link">exactextractr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflowsets" class="external-link">workflowsets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/themis" class="external-link">themis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ggbrick</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optional packages for advanced modeling or visualization:</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ranger"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://imbs-hl.github.io/ranger/" class="external-link">ranger</a></span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"xgboost"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmlc/xgboost" class="external-link">xgboost</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="define-the-area-of-interest">1. Define the Area of Interest<a class="anchor" aria-label="anchor" href="#define-the-area-of-interest"></a>
</h2>
<p>We start by defining the geographical area for modeling. Here we use
Costa Rica as an example. The file is includesd in the ‘h3sdm’
package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cr</span> <span class="op">&lt;-</span> <span class="va">cr_outline_c</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-environmental-predictors">2. Load Environmental Predictors<a class="anchor" aria-label="anchor" href="#load-environmental-predictors"></a>
</h2>
<p>We use WorldClim historic bioclimatic variables for Costa Rica as
environmental predictors. The data is included in the ‘h3sdm’
package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"bioclim_current.tif"</span>, package <span class="op">=</span> <span class="st">"h3sdm"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bio</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*bio_"</span>, <span class="st">"bio"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bio</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-species-occurrence-data">3. Load Species Occurrence Data<a class="anchor" aria-label="anchor" href="#load-species-occurrence-data"></a>
</h2>
<p>Here we obtain presence–absence data for the species of interest
(Silverstoneia flotator). We use the h3sdm_pa function to generate both
presence and pseudo-absence records. A limit of 10,000 records is set to
ensure that all presence records are retrieved, and 300 pseudo-absences
are generated.</p>
<p>There are different methods for generating pseudo-absences; here, we
rely on random sampling. Since there are approximately 100 positive
hexagons at resolution 7, we request three times that number (i.e., 300)
of pseudo-absences. At this resolution, H3 hexagons are about 5.16 ha in
size. These parameters can be adjusted depending on your specific needs
and the characteristics of the species being modeled.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_pa.html">h3sdm_pa</a></span><span class="op">(</span><span class="st">"Silverstoneia flotator"</span>, <span class="va">cr</span>, res <span class="op">=</span> <span class="fl">7</span>, limit <span class="op">=</span> <span class="fl">10000</span>, n_pseudoabs <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">records</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -84.06344 ymin: 8.486587 xmax: -82.77295 ymax: 9.643344</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;          h3_address presence                       geometry</span></span>
<span><span class="co">#&gt; 43  8766b4415ffffff        1 MULTIPOLYGON (((-84.05549 9...</span></span>
<span><span class="co">#&gt; 165 87679b636ffffff        1 MULTIPOLYGON (((-82.79149 9...</span></span>
<span><span class="co">#&gt; 198 8766b54d3ffffff        1 MULTIPOLYGON (((-83.18895 8...</span></span>
<span><span class="co">#&gt; 427 87679b78effffff        1 MULTIPOLYGON (((-82.85228 9...</span></span>
<span><span class="co">#&gt; 796 8766b0135ffffff        1 MULTIPOLYGON (((-83.71366 8...</span></span>
<span><span class="co">#&gt; 893 8766b014cffffff        1 MULTIPOLYGON (((-83.53362 8...</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">records</span><span class="op">$</span><span class="va">presence</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   0   1 </span></span>
<span><span class="co">#&gt; 300 114</span></span></code></pre></div>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="prepare-predictors">4. Prepare Predictors<a class="anchor" aria-label="anchor" href="#prepare-predictors"></a>
</h2>
<p>Prepare environmental predictors by extracting values for each
hexagon in the study area.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">h7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_get_grid.html">h3sdm_get_grid</a></span><span class="op">(</span><span class="va">cr</span>, res <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">h7</span><span class="op">)</span></span></code></pre></div>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio_predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_extract_num.html">h3sdm_extract_num</a></span><span class="op">(</span><span class="va">bio</span>, <span class="va">h7</span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                     |                                                             |   0%  |                                                                     |                                                             |   1%  |                                                                     |=                                                            |   1%  |                                                                     |=                                                            |   2%  |                                                                     |==                                                           |   2%  |                                                                     |==                                                           |   3%  |                                                                     |==                                                           |   4%  |                                                                     |===                                                          |   4%  |                                                                     |===                                                          |   5%  |                                                                     |===                                                          |   6%  |                                                                     |====                                                         |   6%  |                                                                     |====                                                         |   7%  |                                                                     |=====                                                        |   7%  |                                                                     |=====                                                        |   8%  |                                                                     |=====                                                        |   9%  |                                                                     |======                                                       |   9%  |                                                                     |======                                                       |  10%  |                                                                     |======                                                       |  11%  |                                                                     |=======                                                      |  11%  |                                                                     |=======                                                      |  12%  |                                                                     |========                                                     |  12%  |                                                                     |========                                                     |  13%  |                                                                     |========                                                     |  14%  |                                                                     |=========                                                    |  14%  |                                                                     |=========                                                    |  15%  |                                                                     |=========                                                    |  16%  |                                                                     |==========                                                   |  16%  |                                                                     |==========                                                   |  17%  |                                                                     |===========                                                  |  17%  |                                                                     |===========                                                  |  18%  |                                                                     |===========                                                  |  19%  |                                                                     |============                                                 |  19%  |                                                                     |============                                                 |  20%  |                                                                     |=============                                                |  20%  |                                                                     |=============                                                |  21%  |                                                                     |=============                                                |  22%  |                                                                     |==============                                               |  22%  |                                                                     |==============                                               |  23%  |                                                                     |==============                                               |  24%  |                                                                     |===============                                              |  24%  |                                                                     |===============                                              |  25%  |                                                                     |================                                             |  25%  |                                                                     |================                                             |  26%  |                                                                     |================                                             |  27%  |                                                                     |=================                                            |  27%  |                                                                     |=================                                            |  28%  |                                                                     |=================                                            |  29%  |                                                                     |==================                                           |  29%  |                                                                     |==================                                           |  30%  |                                                                     |===================                                          |  30%  |                                                                     |===================                                          |  31%  |                                                                     |===================                                          |  32%  |                                                                     |====================                                         |  32%  |                                                                     |====================                                         |  33%  |                                                                     |====================                                         |  34%  |                                                                     |=====================                                        |  34%  |                                                                     |=====================                                        |  35%  |                                                                     |======================                                       |  35%  |                                                                     |======================                                       |  36%  |                                                                     |======================                                       |  37%  |                                                                     |=======================                                      |  37%  |                                                                     |=======================                                      |  38%  |                                                                     |=======================                                      |  39%  |                                                                     |========================                                     |  39%  |                                                                     |========================                                     |  40%  |                                                                     |=========================                                    |  40%  |                                                                     |=========================                                    |  41%  |                                                                     |=========================                                    |  42%  |                                                                     |==========================                                   |  42%  |                                                                     |==========================                                   |  43%  |                                                                     |===========================                                  |  43%  |                                                                     |===========================                                  |  44%  |                                                                     |===========================                                  |  45%  |                                                                     |============================                                 |  45%  |                                                                     |============================                                 |  46%  |                                                                     |============================                                 |  47%  |                                                                     |=============================                                |  47%  |                                                                     |=============================                                |  48%  |                                                                     |==============================                               |  48%  |                                                                     |==============================                               |  49%  |                                                                     |==============================                               |  50%  |                                                                     |===============================                              |  50%  |                                                                     |===============================                              |  51%  |                                                                     |===============================                              |  52%  |                                                                     |================================                             |  52%  |                                                                     |================================                             |  53%  |                                                                     |=================================                            |  53%  |                                                                     |=================================                            |  54%  |                                                                     |=================================                            |  55%  |                                                                     |==================================                           |  55%  |                                                                     |==================================                           |  56%  |                                                                     |==================================                           |  57%  |                                                                     |===================================                          |  57%  |                                                                     |===================================                          |  58%  |                                                                     |====================================                         |  58%  |                                                                     |====================================                         |  59%  |                                                                     |====================================                         |  60%  |                                                                     |=====================================                        |  60%  |                                                                     |=====================================                        |  61%  |                                                                     |======================================                       |  61%  |                                                                     |======================================                       |  62%  |                                                                     |======================================                       |  63%  |                                                                     |=======================================                      |  63%  |                                                                     |=======================================                      |  64%  |                                                                     |=======================================                      |  65%  |                                                                     |========================================                     |  65%  |                                                                     |========================================                     |  66%  |                                                                     |=========================================                    |  66%  |                                                                     |=========================================                    |  67%  |                                                                     |=========================================                    |  68%  |                                                                     |==========================================                   |  68%  |                                                                     |==========================================                   |  69%  |                                                                     |==========================================                   |  70%  |                                                                     |===========================================                  |  70%  |                                                                     |===========================================                  |  71%  |                                                                     |============================================                 |  71%  |                                                                     |============================================                 |  72%  |                                                                     |============================================                 |  73%  |                                                                     |=============================================                |  73%  |                                                                     |=============================================                |  74%  |                                                                     |=============================================                |  75%  |                                                                     |==============================================               |  75%  |                                                                     |==============================================               |  76%  |                                                                     |===============================================              |  76%  |                                                                     |===============================================              |  77%  |                                                                     |===============================================              |  78%  |                                                                     |================================================             |  78%  |                                                                     |================================================             |  79%  |                                                                     |================================================             |  80%  |                                                                     |=================================================            |  80%  |                                                                     |=================================================            |  81%  |                                                                     |==================================================           |  81%  |                                                                     |==================================================           |  82%  |                                                                     |==================================================           |  83%  |                                                                     |===================================================          |  83%  |                                                                     |===================================================          |  84%  |                                                                     |====================================================         |  84%  |                                                                     |====================================================         |  85%  |                                                                     |====================================================         |  86%  |                                                                     |=====================================================        |  86%  |                                                                     |=====================================================        |  87%  |                                                                     |=====================================================        |  88%  |                                                                     |======================================================       |  88%  |                                                                     |======================================================       |  89%  |                                                                     |=======================================================      |  89%  |                                                                     |=======================================================      |  90%  |                                                                     |=======================================================      |  91%  |                                                                     |========================================================     |  91%  |                                                                     |========================================================     |  92%  |                                                                     |========================================================     |  93%  |                                                                     |=========================================================    |  93%  |                                                                     |=========================================================    |  94%  |                                                                     |==========================================================   |  94%  |                                                                     |==========================================================   |  95%  |                                                                     |==========================================================   |  96%  |                                                                     |===========================================================  |  96%  |                                                                     |===========================================================  |  97%  |                                                                     |===========================================================  |  98%  |                                                                     |============================================================ |  98%  |                                                                     |============================================================ |  99%  |                                                                     |=============================================================|  99%  |                                                                     |=============================================================| 100%</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_predictors.html">h3sdm_predictors</a></span><span class="op">(</span><span class="va">bio_predictors</span><span class="op">)</span></span></code></pre></div>
<p>In this case we select bio1 (Annual Mean Temperature), bio12 (Annual
Precipitation), and bio15 (Precipitation Seasonality).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="va">predictors</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">h3_address</span>, <span class="va">bio1</span>, <span class="va">bio12</span>, <span class="va">bio15</span>, <span class="va">geometry</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize one of the predictors, for example Bio1.</p>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="combine-records-and-predictors">5. Combine Records and Predictors<a class="anchor" aria-label="anchor" href="#combine-records-and-predictors"></a>
</h2>
<p>Merge species occurrence records with environmental predictors.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_data.html">h3sdm_data</a></span><span class="op">(</span><span class="va">records</span>, <span class="va">predictors</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatial-cross-validation">6. Spatial Cross-Validation<a class="anchor" aria-label="anchor" href="#spatial-cross-validation"></a>
</h2>
<p>Define spatial blocks for cross-validation to account for spatial
autocorrelation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_spatial_cv.html">h3sdm_spatial_cv</a></span><span class="op">(</span><span class="va">dat</span>, v <span class="op">=</span> <span class="fl">5</span>, repeats <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Plot the spatial blocks.</p>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="define-recipe-and-model">7. Define Recipe and Model<a class="anchor" aria-label="anchor" href="#define-recipe-and-model"></a>
</h2>
<p>Create a modeling recipe and specify the classification model. We
start with presence–absence data aggregated in hexagonal cells. From the
initial data, we obtained roughly 100 hexagons with presence (presence =
1). For pseudo-absences, we sampled about three times more absence
hexagons (presence = 0) to ensure sufficient coverage.</p>
<p>This results in an imbalanced dataset, which can bias the model
toward predicting absences. To correct for this, we use
step_downsample(presence) from the themis package.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">receta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_recipe.html">h3sdm_recipe</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">themis</span><span class="fu">::</span><span class="fu"><a href="https://themis.tidymodels.org/reference/step_downsample.html" class="external-link">step_downsample</a></span><span class="op">(</span><span class="va">presence</span><span class="op">)</span></span></code></pre></div>
<p>Key points:</p>
<ul>
<li><p>Only the majority class (pseudo-absence hexagons) is
reduced.</p></li>
<li><p>The minority class (presence hexagons) remains
unchanged.</p></li>
<li><p>After down-sampling, the dataset is balanced, improving model
training and evaluation.</p></li>
</ul>
<p>In our case, down-sampling ensures that the 100 presence hexagons and
a comparable number of pseudo-absence hexagons are used for modeling,
preventing bias toward absences while retaining the full presence
information.</p>
<p>Now we define a logistic regression model using the
<code>parsnip</code> package, from the tidymodels framework.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelo</span> <span class="op">&lt;-</span> <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html" class="external-link">logistic_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"glm"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-workflow">8. Create Workflow<a class="anchor" aria-label="anchor" href="#create-workflow"></a>
</h2>
<p>Create a workflow combining the recipe and model.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_workflow.html">h3sdm_workflow</a></span><span class="op">(</span><span class="va">modelo</span>, <span class="va">receta</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-the-model">9. Fit the Model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h2>
<p>Before fitting the model, we need to extract the presence data from
the dataset. This ensures that metrics, cross-validation, and evaluation
focus correctly on the locations where the species is actually
present.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">presence_data</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">presence</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Next, we fit the model using the spatial cross-validation scheme.
Spatial CV accounts for spatial autocorrelation by partitioning the data
into spatially distinct folds, providing a more realistic assessment of
model performance compared to random CV.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_fit_model.html">h3sdm_fit_model</a></span><span class="op">(</span><span class="va">wf</span>, <span class="va">scv</span>, <span class="va">presence_data</span><span class="op">)</span></span></code></pre></div>
<p>Key points:</p>
<ul>
<li><p>presence_data contains all hexagons with presence = 1.</p></li>
<li><p>The cross-validation folds are spatially blocked to reduce
leakage between training and test data.</p></li>
<li><p>The model is trained and validated using these folds, ensuring
robust performance evaluation.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="evaluate-model-performance">10. Evaluate Model Performance<a class="anchor" aria-label="anchor" href="#evaluate-model-performance"></a>
</h2>
<p>After fitting the model, assess its performance using cross-validated
metrics such as <strong>ROC-AUC</strong>, <strong>accuracy</strong>,
<strong>TSS</strong>, and the <strong>Boyce index</strong>. The
h3sdm_eval_metrics() function computes these metrics based on the fitted
model and the presence data, providing a quantitative measure of how
well the model distinguishes presence from absence across spatial
folds.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">evaluation_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_eval_metrics.html">h3sdm_eval_metrics</a></span><span class="op">(</span></span>
<span>  fitted_model  <span class="op">=</span> <span class="va">f</span><span class="op">$</span><span class="va">cv_model</span>,</span>
<span>  presence_data <span class="op">=</span> <span class="va">presence_data</span></span>
<span><span class="op">)</span></span>
<span><span class="va">evaluation_metrics</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 6</span></span></span>
<span><span class="co">#&gt;   .metric  .estimator  mean std_err conf_low conf_high</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> accuracy binary     0.673  0.048<span style="text-decoration: underline;">9</span>   0.577      0.768</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> f_meas   binary     0.743  0.042<span style="text-decoration: underline;">0</span>   0.660      0.825</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> kap      binary     0.292  0.101    0.093<span style="text-decoration: underline;">4</span>     0.490</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> roc_auc  binary     0.685  0.073<span style="text-decoration: underline;">4</span>   0.541      0.828</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> sens     binary     0.650  0.060<span style="text-decoration: underline;">1</span>   0.532      0.768</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> spec     binary     0.696  0.121    0.459      0.933</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> tss      binary     0.478 <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> boyce    binary     0.666 <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>         <span style="color: #BB0000;">NA</span></span></span></code></pre></div>
<p>Key points:</p>
<ul>
<li><p>Metrics are computed using spatial cross-validation, so results
reflect realistic predictive performance.</p></li>
<li><p>ROC-AUC evaluates discrimination ability; TSS balances
sensitivity and specificity.</p></li>
<li><p>The Boyce index evaluates how well predicted suitability matches
observed presences, which is particularly useful for presence-only or
pseudo-absence data.</p></li>
<li><p>These metrics help identify whether the model reliably predicts
species occurrence.</p></li>
</ul>
<p>We can visualize the metrics.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">evaluation_metrics</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">.metric</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.03</span>, color <span class="op">=</span> <span class="st">"dodgerblue3"</span>, fill <span class="op">=</span> <span class="st">"dodgerblue3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="make-predictions">11. Make Predictions<a class="anchor" aria-label="anchor" href="#make-predictions"></a>
</h2>
<p>Generate spatial predictions for the species distribution across the
study area.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_predict.html">h3sdm_predict</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">predictors</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="map">12. Map<a class="anchor" aria-label="anchor" href="#map"></a>
</h2>
<p>Now we can visualize the predictions in a map.</p>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>The map represents habitat suitability for the species across the
hexagons. The values (usually between 0 and 1 for a logistic model)
indicate the habitat suitability of each hexagon for the species.</p>
<p>Interpretation of the prediction values:</p>
<ul>
<li>Higher values → more suitable habitat</li>
<li>Lower values → less suitable habitat</li>
</ul>
</div>
<div class="section level2">
<h2 id="model-interpretation-feature-importance-partial-dependence">13. Model Interpretation: Feature Importance &amp; Partial
Dependence<a class="anchor" aria-label="anchor" href="#model-interpretation-feature-importance-partial-dependence"></a>
</h2>
<p>Finallly, we interpret the model to understand which predictors are
most influential and how they affect predictions.</p>
<p>First we create an explainer object using the DALEX package.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_explain.html">h3sdm_explain</a></span><span class="op">(</span><span class="va">f</span><span class="op">$</span><span class="va">final_model</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preparation of a new explainer is initiated</span></span>
<span><span class="co">#&gt;   -&gt; model label       :  h3sdm workflow </span></span>
<span><span class="co">#&gt;   -&gt; data              :  414  rows  6  cols </span></span>
<span><span class="co">#&gt;   -&gt; target variable   :  414  values </span></span>
<span><span class="co">#&gt;   -&gt; predict function  :  custom_predict </span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  No value for predict function target column. (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  package tidymodels , ver. 1.4.1 , task classification (  default  ) </span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  numerical, min =  0.001604346 , mean =  0.4662787 , max =  0.8956116  </span></span>
<span><span class="co">#&gt;   -&gt; residual function :  difference between y and yhat (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; residuals         :  numerical, min =  -0.8956116 , mean =  -0.1909164 , max =  0.8797704  </span></span>
<span><span class="co">#&gt;   A new explainer has been created!</span></span></code></pre></div>
<div class="section level3">
<h3 id="feature-importance">Feature Importance<a class="anchor" aria-label="anchor" href="#feature-importance"></a>
</h3>
<p>We evaluate the importance of each predictor variable using
permutation importance. This method assesses how much the model’s
performance decreases when the values of a predictor are randomly
shuffled, indicating its contribution to the model.</p>
<p>We need to specify the predictor variables to evaluate, excluding
non-predictor columns.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictors_to_evaluate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">e</span><span class="op">$</span><span class="va">data</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"h3_address"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"presence"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we compute variable importance.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_parts.html" class="external-link">model_parts</a></span><span class="op">(</span></span>
<span>  explainer <span class="op">=</span> <span class="va">e</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">predictors_to_evaluate</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can visualize the variable importance.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">var_imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="partial-dependence-plots">Partial Dependence Plots<a class="anchor" aria-label="anchor" href="#partial-dependence-plots"></a>
</h3>
<p>We create partial dependence plots (PDPs) to visualize the
relationship between key predictors and the predicted habitat
suitability. PDPs show how the predicted outcome changes as a single
predictor varies, while averaging out the effects of other
predictors.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pdp_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ModelOriented.github.io/ingredients/reference/partial_dependence.html" class="external-link">partial_dependence</a></span><span class="op">(</span><span class="va">e</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio12"</span>, <span class="st">"bio1"</span>, <span class="st">"bio15"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we can plot the PDPs.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdp_glm</span><span class="op">)</span></span></code></pre></div>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<p>All predictors show a positive relationship with habitat suitability,
but Bio12 (annual precipitation) and Bio1 (mean annual temperature)
stand out with higher importance and stronger positive effects. In
contrast, Bio15 (precipitation seasonality) has a weaker positive
effect, suggesting that while areas with variable rainfall are somewhat
suitable, they are less influential than Bio12 or Bio1.</p>
</div>
</div>
<div class="section level2">
<h2 id="categorize-habitat-suitability">14. Categorize Habitat Suitability<a class="anchor" aria-label="anchor" href="#categorize-habitat-suitability"></a>
</h2>
<p>We can categorize the continuous habitat suitability predictions into
discrete classes for easier interpretation. Here we define five
categories: “Very low”, “Low”, “Medium”, “High”, and “Very high”.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    habitat_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>      <span class="va">prediction</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span><span class="op">)</span>,</span>
<span>      include.lowest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now we can visualize the categorized habitat suitability in a
map.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">p</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">habitat_cat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Habitat \ncategory"</span>, option <span class="op">=</span> <span class="st">"B"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, na.translate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>We can also count the number of hexagons in each habitat suitability
category.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_current</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">habitat_cat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Present"</span><span class="op">)</span></span>
<span><span class="va">counts_current</span></span>
<span><span class="co">#&gt;   habitat_cat    n scenario</span></span>
<span><span class="co">#&gt; 1    Very low 2287  Present</span></span>
<span><span class="co">#&gt; 2         Low 3295  Present</span></span>
<span><span class="co">#&gt; 3      Medium 1554  Present</span></span>
<span><span class="co">#&gt; 4        High 2542  Present</span></span>
<span><span class="co">#&gt; 5   Very high  738  Present</span></span></code></pre></div>
<p>Now we can create a waffle plot to visualize the distribution of
habitat suitability categories.</p>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="make-predictios-for-a-future-scenario">15. Make predictios for a future scenario<a class="anchor" aria-label="anchor" href="#make-predictios-for-a-future-scenario"></a>
</h2>
<p>We can also make predictions for future climate scenarios. Here we
use WorldClim future bioclimatic variables for Costa Rica as
environmental predictors. The data is included in the ‘h3sdm’ package.
Only three variables are included: Bio1 (Annual Mean Temperature), Bio12
(Annual Precipitation), and Bio15 (Precipitation Seasonality).</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio_future</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"bioclim_future.tif"</span>, package <span class="op">=</span> <span class="st">"h3sdm"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Rename the layers of the raster to match the names used in the
model.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bio_future</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio1"</span>, <span class="st">"bio12"</span>, <span class="st">"bio15"</span><span class="op">)</span> </span></code></pre></div>
<p>We prepare the future predictors by extracting values for each
hexagon in the study area.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio_future_predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_extract_num.html">h3sdm_extract_num</a></span><span class="op">(</span><span class="va">bio_future</span>, <span class="va">h7</span><span class="op">)</span></span>
<span><span class="co">#&gt;   |                                                                     |                                                             |   0%  |                                                                     |                                                             |   1%  |                                                                     |=                                                            |   1%  |                                                                     |=                                                            |   2%  |                                                                     |==                                                           |   2%  |                                                                     |==                                                           |   3%  |                                                                     |==                                                           |   4%  |                                                                     |===                                                          |   4%  |                                                                     |===                                                          |   5%  |                                                                     |===                                                          |   6%  |                                                                     |====                                                         |   6%  |                                                                     |====                                                         |   7%  |                                                                     |=====                                                        |   7%  |                                                                     |=====                                                        |   8%  |                                                                     |=====                                                        |   9%  |                                                                     |======                                                       |   9%  |                                                                     |======                                                       |  10%  |                                                                     |======                                                       |  11%  |                                                                     |=======                                                      |  11%  |                                                                     |=======                                                      |  12%  |                                                                     |========                                                     |  12%  |                                                                     |========                                                     |  13%  |                                                                     |========                                                     |  14%  |                                                                     |=========                                                    |  14%  |                                                                     |=========                                                    |  15%  |                                                                     |=========                                                    |  16%  |                                                                     |==========                                                   |  16%  |                                                                     |==========                                                   |  17%  |                                                                     |===========                                                  |  17%  |                                                                     |===========                                                  |  18%  |                                                                     |===========                                                  |  19%  |                                                                     |============                                                 |  19%  |                                                                     |============                                                 |  20%  |                                                                     |=============                                                |  20%  |                                                                     |=============                                                |  21%  |                                                                     |=============                                                |  22%  |                                                                     |==============                                               |  22%  |                                                                     |==============                                               |  23%  |                                                                     |==============                                               |  24%  |                                                                     |===============                                              |  24%  |                                                                     |===============                                              |  25%  |                                                                     |================                                             |  25%  |                                                                     |================                                             |  26%  |                                                                     |================                                             |  27%  |                                                                     |=================                                            |  27%  |                                                                     |=================                                            |  28%  |                                                                     |=================                                            |  29%  |                                                                     |==================                                           |  29%  |                                                                     |==================                                           |  30%  |                                                                     |===================                                          |  30%  |                                                                     |===================                                          |  31%  |                                                                     |===================                                          |  32%  |                                                                     |====================                                         |  32%  |                                                                     |====================                                         |  33%  |                                                                     |====================                                         |  34%  |                                                                     |=====================                                        |  34%  |                                                                     |=====================                                        |  35%  |                                                                     |======================                                       |  35%  |                                                                     |======================                                       |  36%  |                                                                     |======================                                       |  37%  |                                                                     |=======================                                      |  37%  |                                                                     |=======================                                      |  38%  |                                                                     |=======================                                      |  39%  |                                                                     |========================                                     |  39%  |                                                                     |========================                                     |  40%  |                                                                     |=========================                                    |  40%  |                                                                     |=========================                                    |  41%  |                                                                     |=========================                                    |  42%  |                                                                     |==========================                                   |  42%  |                                                                     |==========================                                   |  43%  |                                                                     |===========================                                  |  43%  |                                                                     |===========================                                  |  44%  |                                                                     |===========================                                  |  45%  |                                                                     |============================                                 |  45%  |                                                                     |============================                                 |  46%  |                                                                     |============================                                 |  47%  |                                                                     |=============================                                |  47%  |                                                                     |=============================                                |  48%  |                                                                     |==============================                               |  48%  |                                                                     |==============================                               |  49%  |                                                                     |==============================                               |  50%  |                                                                     |===============================                              |  50%  |                                                                     |===============================                              |  51%  |                                                                     |===============================                              |  52%  |                                                                     |================================                             |  52%  |                                                                     |================================                             |  53%  |                                                                     |=================================                            |  53%  |                                                                     |=================================                            |  54%  |                                                                     |=================================                            |  55%  |                                                                     |==================================                           |  55%  |                                                                     |==================================                           |  56%  |                                                                     |==================================                           |  57%  |                                                                     |===================================                          |  57%  |                                                                     |===================================                          |  58%  |                                                                     |====================================                         |  58%  |                                                                     |====================================                         |  59%  |                                                                     |====================================                         |  60%  |                                                                     |=====================================                        |  60%  |                                                                     |=====================================                        |  61%  |                                                                     |======================================                       |  61%  |                                                                     |======================================                       |  62%  |                                                                     |======================================                       |  63%  |                                                                     |=======================================                      |  63%  |                                                                     |=======================================                      |  64%  |                                                                     |=======================================                      |  65%  |                                                                     |========================================                     |  65%  |                                                                     |========================================                     |  66%  |                                                                     |=========================================                    |  66%  |                                                                     |=========================================                    |  67%  |                                                                     |=========================================                    |  68%  |                                                                     |==========================================                   |  68%  |                                                                     |==========================================                   |  69%  |                                                                     |==========================================                   |  70%  |                                                                     |===========================================                  |  70%  |                                                                     |===========================================                  |  71%  |                                                                     |============================================                 |  71%  |                                                                     |============================================                 |  72%  |                                                                     |============================================                 |  73%  |                                                                     |=============================================                |  73%  |                                                                     |=============================================                |  74%  |                                                                     |=============================================                |  75%  |                                                                     |==============================================               |  75%  |                                                                     |==============================================               |  76%  |                                                                     |===============================================              |  76%  |                                                                     |===============================================              |  77%  |                                                                     |===============================================              |  78%  |                                                                     |================================================             |  78%  |                                                                     |================================================             |  79%  |                                                                     |================================================             |  80%  |                                                                     |=================================================            |  80%  |                                                                     |=================================================            |  81%  |                                                                     |==================================================           |  81%  |                                                                     |==================================================           |  82%  |                                                                     |==================================================           |  83%  |                                                                     |===================================================          |  83%  |                                                                     |===================================================          |  84%  |                                                                     |====================================================         |  84%  |                                                                     |====================================================         |  85%  |                                                                     |====================================================         |  86%  |                                                                     |=====================================================        |  86%  |                                                                     |=====================================================        |  87%  |                                                                     |=====================================================        |  88%  |                                                                     |======================================================       |  88%  |                                                                     |======================================================       |  89%  |                                                                     |=======================================================      |  89%  |                                                                     |=======================================================      |  90%  |                                                                     |=======================================================      |  91%  |                                                                     |========================================================     |  91%  |                                                                     |========================================================     |  92%  |                                                                     |========================================================     |  93%  |                                                                     |=========================================================    |  93%  |                                                                     |=========================================================    |  94%  |                                                                     |==========================================================   |  94%  |                                                                     |==========================================================   |  95%  |                                                                     |==========================================================   |  96%  |                                                                     |===========================================================  |  96%  |                                                                     |===========================================================  |  97%  |                                                                     |===========================================================  |  98%  |                                                                     |============================================================ |  98%  |                                                                     |============================================================ |  99%  |                                                                     |=============================================================|  99%  |                                                                     |=============================================================| 100%</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictors_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_predictors.html">h3sdm_predictors</a></span><span class="op">(</span><span class="va">bio_future_predictors</span><span class="op">)</span></span></code></pre></div>
<p>Now we can make predictions for the future scenario.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_future</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/h3sdm_predict.html">h3sdm_predict</a></span><span class="op">(</span><span class="va">f</span>, <span class="va">predictors_future</span><span class="op">)</span></span></code></pre></div>
<p>We can visualize the future predictions in a map.</p>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-46-1.png" width="700"></p>
<p>We can categorize the continuous habitat suitability predictions into
discrete classes for easier interpretation. Here we define five
categories: “Very low”, “Low”, “Medium”, “High”, and “Very high”.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_future</span> <span class="op">&lt;-</span> <span class="va">p_future</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    habitat_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span></span>
<span>      <span class="va">prediction</span>,</span>
<span>      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Very low"</span>, <span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Very high"</span><span class="op">)</span>,</span>
<span>      include.lowest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now we can visualize the categorized habitat suitability in a
map.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">p_future</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">habitat_cat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Habitat \ncategory"</span>, option <span class="op">=</span> <span class="st">"B"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, na.translate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
<p>We can also count the number of hexagons in each habitat suitability
category.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_future</span> <span class="op">&lt;-</span> <span class="va">p_future</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">habitat_cat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"Future"</span><span class="op">)</span></span>
<span><span class="va">counts_future</span></span>
<span><span class="co">#&gt;   habitat_cat    n scenario</span></span>
<span><span class="co">#&gt; 1    Very low 2130   Future</span></span>
<span><span class="co">#&gt; 2         Low 3393   Future</span></span>
<span><span class="co">#&gt; 3      Medium 1519   Future</span></span>
<span><span class="co">#&gt; 4        High 2563   Future</span></span>
<span><span class="co">#&gt; 5   Very high  776   Future</span></span></code></pre></div>
<p>Now we can create a waffle plot to visualize the distribution of
habitat suitability categories for the future scenario.</p>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-51-1.png" width="700"></p>
<p>Now we can create a waffle plot to visualize the distribution of
habitat suitability categories for both present and future
scenarios.</p>
<p><img src="h3sdm_files/figure-html/unnamed-chunk-54-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="conclusions">16. Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>This tutorial demonstrated a complete SDM workflow for a single model
using the <code>h3sdm</code> package. The key steps included:</p>
<ul>
<li><p>Defining the study area</p></li>
<li><p>Loading and preparing environmental predictors</p></li>
<li><p>Fetching species occurrence data</p></li>
<li><p>Building a predictive model with spatial
cross-validation</p></li>
<li><p>Evaluating performance and making predictions</p></li>
<li><p>Assessing variable importance</p></li>
<li><p>Categorizing habitat suitability</p></li>
<li><p>Making predictions for future climate scenarios</p></li>
<li><p>Comparing habitat suitability between present and future
scenarios</p></li>
</ul>
<p>This workflow demonstrates modeling for a single species using one
model. It can be easily adapted to handle multiple species or more
complex modeling scenarios, as illustrated in the Articles section.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Manuel Spínola.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
