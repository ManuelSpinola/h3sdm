% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/h3sdm_get_records_by_hexagon.R
\name{h3sdm_get_records_by_hexagon}
\alias{h3sdm_get_records_by_hexagon}
\title{Download Species Records and Count Occurrences per H3 Hexagon}
\usage{
h3sdm_get_records_by_hexagon(
  species,
  aoi_sf,
  res = 6,
  providers = NULL,
  remove_duplicates = FALSE,
  date = NULL,
  expand_factor = 0.1,
  limit = 500
)
}
\arguments{
\item{species}{Character vector of species names to query (e.g., \code{c("Puma concolor", "Panthera onca")}).}

\item{aoi_sf}{An \code{sf} polygon defining the Area of Interest (AOI).}

\item{res}{Numeric. H3 resolution level (default 6), determining hexagon size.}

\item{providers}{Character vector of data providers (e.g., "gbif"). If \code{NULL}, all providers are used.}

\item{remove_duplicates}{Logical. If \code{TRUE}, duplicate coordinates are removed before counting. Default is \code{FALSE}.}

\item{date}{Character vector specifying a date range (e.g., \code{c('2000-01-01','2020-12-31')}).}

\item{expand_factor}{Numeric. Factor to expand the AOI bounding box before generating the H3 grid. Default is 0.1.}

\item{limit}{Numeric. Maximum number of records to retrieve per species per provider. Default is 500.}
}
\value{
An \code{sf} object containing the H3 hexagonal grid (\code{MULTIPOLYGON}) with
additional integer columns for each species (spaces replaced by underscores) showing
the count of occurrence records in each hexagon. Hexagons with no records have 0.
}
\description{
This function downloads occurrence records for one or more species and counts
the number of records falling inside each H3 hexagon covering the specified Area
of Interest (AOI).
}
\details{
Download Species Records and Count Occurrences per H3 Hexagon

For each species:
\enumerate{
\item An H3 grid is generated across the AOI using \code{h3sdm_get_grid()}.
\item Occurrence records are downloaded using \code{h3sdm_get_records()}.
\item Points are joined to the hexagonal grid with \code{sf::st_join()}.
\item Counts of points per hexagon are calculated.
\item Counts are merged into the main hex grid.
}
The function ensures column names derived from species names are safe in R
by replacing spaces with underscores and handles API failures gracefully.
}
\examples{
\dontrun{
# Assuming aoi_sf is a valid sf polygon
# species_list <- c("Agalychnis callidryas", "Smilisca baudinii")
# hex_counts <- h3sdm_get_records_by_hexagon(species_list, aoi_sf, res = 7, limit = 1000)
# head(hex_counts)
}

}
\seealso{
\code{\link[h3sdm]{h3sdm_get_grid}}, \code{\link[h3sdm]{h3sdm_get_records}}
}
